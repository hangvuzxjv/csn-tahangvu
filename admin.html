<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ†Ô∏è Qu·∫£n Tr·ªã H·ªá Th·ªëng - Duy·ªát B√†i</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="config.js"></script>
    <link rel="stylesheet" href="style.css">
    <script>
        // Ki·ªÉm tra quy·ªÅn admin qua session
        async function checkAdminAccess() {
            try {
                const url = window.apiUrl ? apiUrl('db.php/check_session.php') : '/Project/db.php/check_session.php';
                const response = await fetch(url);
                const result = await response.json();
                
                if (!result.isLoggedIn) {
                    alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ truy c·∫≠p trang qu·∫£n tr·ªã.');
                    window.location.href = 'dangnhap.html';
                    return false;
                } else if (result.role !== 'admin') {
                    const authCheck = document.getElementById('auth-check');
                    if (authCheck) {
                        authCheck.classList.remove('hidden');
                        authCheck.textContent = '‚ùå B·∫†N KH√îNG C√ì QUY·ªÄN TRUY C·∫¨P (Ch·ªâ d√†nh cho ADMIN).';
                    }
                    return false;
                }
                return true;
            } catch (error) {
                console.error('L·ªói ki·ªÉm tra quy·ªÅn:', error);
                alert('L·ªói k·∫øt n·ªëi server.');
                window.location.href = 'index.html';
                return false;
            }
        }
        
        // G·ªçi ngay khi load trang
        checkAdminAccess();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .admin-tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            color: #6b7280; /* text-gray-400 */
        }
        .admin-tab.active {
            border-bottom-color: #ef4444; /* M√†u Red-500 */
            color: #b91c1c; /* M√†u Red-700 */
        }
        /* Custom CSS cho Admin Post List */
        .admin-post-item {
            padding: 1rem;
            background-color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-left-width: 4px;
            border-radius: 0.5rem;
        }
        /* ƒê·ªãnh nghƒ©a m√†u border cho c√°c tr·∫°ng th√°i */
        .border-green-500 { border-left-color: #10b981; } 
        .border-yellow-500 { border-left-color: #f59e0b; } 
        .border-red-500 { border-left-color: #ef4444; } 
    </style>
</head>
<body class="bg-gray-100">

    <!-- HEADER -->
    <header class="sticky top-0 z-50 bg-white shadow-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <a href="index.html" class="flex items-center space-x-3 hover:opacity-90 transition"><img src="img/logo.png" alt="Logo" class="h-10 w-10"><span class="text-2xl font-bold text-teal-600">Th·ªßy S·∫£n</span></a>
                <span class="text-sm font-bold text-red-500 hidden md:inline">TRANG QU·∫¢N TR·ªä</span>
            </div>
            
            <div id="user-profile" class="relative">
                <button class="flex items-center space-x-2 text-gray-700 hover:text-red-600" id="user-menu-btn">
                    <img src="img/avt1.jpg" alt="Avatar" class="w-8 h-8 rounded-full object-cover border-2 border-red-500">
                    <span class="text-sm font-medium text-red-600">ADMIN</span>
                </button>
                <div id="user-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 hidden">
                    <a href="profile.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"> Profile</a>
                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" onclick="logout()"> ƒêƒÉng Xu·∫•t</a>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-10">
        <h1 class="text-4xl font-extrabold text-red-600 mb-6">üõ†Ô∏è B·∫£ng ƒêi·ªÅu Khi·ªÉn Qu·∫£n Tr·ªã</h1>
        
        <div id="auth-check" class="bg-red-200 p-4 rounded-lg text-red-800 font-semibold text-center mb-8 hidden">
            ‚ùå B·∫†N KH√îNG C√ì QUY·ªÄN TRUY C·∫¨P (Ch·ªâ d√†nh cho ADMIN).
        </div>
        
        <div id="admin-tabs" class="flex space-x-4 border-b border-gray-300 mb-8">
            <div class="admin-tab active" data-tab="pending">Duy·ªát B√†i Vi·∫øt</div>
            <div class="admin-tab" data-tab="all">Qu·∫£n L√Ω T·∫§T C·∫¢ B√†i Vi·∫øt</div>
        </div>
        
        <div id="tab-content-pending" class="tab-content space-y-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">B√†i Vi·∫øt Ch·ªù Duy·ªát</h2>
            <div id="pending-posts-list">
                <!-- N·ªôi dung B√†i vi·∫øt Ch·ªù duy·ªát -->
            </div>
        </div>
        
        <div id="tab-content-all" class="tab-content space-y-6 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">T·∫•t C·∫£ B√†i Vi·∫øt ƒê√£ ƒêƒÉng</h2>
            <div id="all-posts-list">
                <!-- N·ªôi dung T·∫•t c·∫£ B√†i vi·∫øt -->
            </div>
        </div>

    </main>

    <!-- FOOTER -->
    <footer class="bg-gradient-to-r from-slate-800 to-slate-900 text-white mt-12 pt-10 pb-6">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 border-b border-slate-700 pb-8">
                <div>
                    <a href="index.html" class="flex items-center space-x-2"><img src="img/logo.png" alt="Logo" class="h-8 w-8"><span class="text-2xl font-bold text-teal-400">Th·ªßy S·∫£n</span></a>
                    <p class="text-sm text-white mt-4 leading-relaxed">C·ªïng th√¥ng tin k·ªπ thu·∫≠t nu√¥i tr·ªìng th·ªßy s·∫£n...</p>
                </div>
                <div><h3 class="text-lg font-semibold text-white mb-4 border-b border-teal-500 pb-1">ƒêi·ªÅu H∆∞·ªõng</h3><ul class="space-y-2 text-sm"><li><a href="index.html" class="text-white hover:text-white transition">Trang Ch·ªß</a></li><li><a href="tintuc.html" class="text-white hover:text-white transition">Tin T·ª©c C·ªông ƒê·ªìng</a></li><li><a href="kythuat-nuoi.html" class="text-white hover:text-white transition">K·ªπ Thu·∫≠t Nu√¥i Tr·ªìng</a></li><li><a href="dangtin.html" class="text-white hover:text-white transition">ƒêƒÉng B√†i/Chia S·∫ª</a></li></ul></div>
                <div><h3 class="text-lg font-semibold text-white mb-4 border-b border-teal-500 pb-1">Tra C·ª©u Nhanh</h3><ul class="space-y-2 text-sm"><li><a href="kythuat-nuoi.html" class="text-white hover:text-white transition">K·ªπ Thu·∫≠t Nu√¥i T√¥m/C√°</a></li><li><a href="benh-thuy-san.html" class="text-white hover:text-white transition">Ph√°c ƒê·ªì B·ªánh Th·ªßy S·∫£n</a></li><li></li><li></li></ul></div>
                <div><h3 class="text-lg font-semibold text-white mb-4 border-b border-teal-500 pb-1">Li√™n H·ªá</h3><ul class="space-y-2 text-sm"><li><span class="text-white">ƒê·ªãa ch·ªâ:</span> <span class="text-white">Tr√† Vinh, Vi·ªát Nam</span></li><li><span class="text-white">Email:</span> <a href="mailto:info@tvfishfarm.com" class="text-teal-400 hover:underline">info@tvfishfarm.com</a></li><li><span class="text-white">ƒêi·ªán tho·∫°i:</span> <span class="text-white">(+84) 9xxyyyyzzz</span></li></ul></div>
            </div>
            <div class="mt-6 text-center text-sm text-gray-400">
                &copy; 2025 K·ªπ Thu·∫≠t Nu√¥i Tr·ªìng Th·ªßy S·∫£n Tr√† Vinh. ƒê∆∞·ª£c ph√°t tri·ªÉn t·∫°i <span class="text-teal-400">Tr√† Vinh</span>.
            </div>
        </div>
    </footer>


    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Ki·ªÉm tra quy·ªÅn admin
            const hasAccess = await checkAdminAccess();
            
            if (hasAccess) {
                renderAdminDashboard(); // T·∫£i tab m·∫∑c ƒë·ªãnh: Ch·ªù duy·ªát
                initializeAdminTabs();
            }
            
            // Kh·ªüi t·∫°o Menu User (c·∫ßn cho header)
            if (typeof checkLoginStatus !== 'undefined') {
                 checkLoginStatus(); 
            }
        });

        function initializeAdminTabs() {
            const tabs = document.querySelectorAll('.admin-tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const target = tab.getAttribute('data-tab');

                    // ·∫®n t·∫•t c·∫£ n·ªôi dung, lo·∫°i b·ªè tr·∫°ng th√°i active
                    tabs.forEach(t => t.classList.remove('active'));
                    contents.forEach(c => c.classList.add('hidden'));

                    // Hi·ªÉn th·ªã n·ªôi dung target, th√™m tr·∫°ng th√°i active
                    tab.classList.add('active');
                    document.getElementById(`tab-content-${target}`).classList.remove('hidden');

                    // T·∫£i d·ªØ li·ªáu cho tab ƒë∆∞·ª£c ch·ªçn
                    if (target === 'all') {
                        renderAllPostsForAdmin();
                    } else if (target === 'pending') {
                        renderAdminDashboard();
                    }
                });
            });
        }
    </script>
</body>
</html>